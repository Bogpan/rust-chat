import{s as x,n as F,r as oe,a as ie,f as ae,b as R}from"../chunks/scheduler.d35e8dc7.js";import{S as $,i as ee,g as k,s as S,m as te,h as w,j as C,c as V,n as se,f as g,k as _,y as q,a as T,x as m,o as ne,l as K,z as re,A as G,B as H,C as N,d as J,b as ue,t as W,D as ce,r as fe,u as de,v as he,w as _e,p as ve}from"../chunks/index.21dcd3ee.js";function Q(s){return(s==null?void 0:s.length)!==void 0?s:Array.from(s)}function pe(s,n){const e={},u={},i={$$scope:1};let t=s.length;for(;t--;){const a=s[t],o=n[t];if(o){for(const l in a)l in o||(u[l]=1);for(const l in o)i[l]||(e[l]=o[l],i[l]=1);s[t]=o}else for(const l in a)i[l]=1}for(const a in u)a in e||(e[a]=void 0);return e}function me(s){return typeof s=="object"&&s!==null?s:{}}function X(s){let n,e,u;return{c(){n=k("div"),e=k("p"),u=te(s[1]),this.h()},l(i){n=w(i,"DIV",{class:!0,style:!0});var t=C(n);e=w(t,"P",{class:!0});var a=C(e);u=se(a,s[1]),a.forEach(g),t.forEach(g),this.h()},h(){_(e,"class","svelte-1qqol0v"),_(n,"class","author"),K(n,"font-size","12px"),K(n,"color","#"+s[4])},m(i,t){T(i,n,t),m(n,e),m(e,u)},p(i,t){t&2&&ne(u,i[1]),t&16&&K(n,"color","#"+i[4])},d(i){i&&g(n)}}}function ge(s){let n,e,u,i,t,a,o=s[1]!==null&&!s[3]&&X(s);return{c(){n=k("div"),e=k("div"),o&&o.c(),u=S(),i=k("div"),t=k("p"),a=te(s[2]),this.h()},l(l){n=w(l,"DIV",{class:!0});var c=C(n);e=w(c,"DIV",{class:!0});var j=C(e);o&&o.l(j),u=V(j),i=w(j,"DIV",{class:!0});var E=C(i);t=w(E,"P",{class:!0});var b=C(t);a=se(b,s[2]),b.forEach(g),E.forEach(g),j.forEach(g),c.forEach(g),this.h()},h(){_(t,"class","svelte-1qqol0v"),_(i,"class","message"),_(e,"class","message-bubble svelte-1qqol0v"),q(e,"clientside",s[3]),q(e,"server",s[0]==="server"),_(n,"class","message-container svelte-1qqol0v"),q(n,"clientside",s[3]),q(n,"server",s[0]==="server")},m(l,c){T(l,n,c),m(n,e),o&&o.m(e,null),m(e,u),m(e,i),m(i,t),m(t,a)},p(l,[c]){l[1]!==null&&!l[3]?o?o.p(l,c):(o=X(l),o.c(),o.m(e,u)):o&&(o.d(1),o=null),c&4&&ne(a,l[2]),c&8&&q(e,"clientside",l[3]),c&1&&q(e,"server",l[0]==="server"),c&8&&q(n,"clientside",l[3]),c&1&&q(n,"server",l[0]==="server")},i:F,o:F,d(l){l&&g(n),o&&o.d()}}}function be(s,n,e){let{kind:u}=n,{author:i}=n,{content:t}=n,{clientside:a}=n,{colour:o}=n;return s.$$set=l=>{"kind"in l&&e(0,u=l.kind),"author"in l&&e(1,i=l.author),"content"in l&&e(2,t=l.content),"clientside"in l&&e(3,a=l.clientside),"colour"in l&&e(4,o=l.colour)},[u,i,t,a,o]}class ke extends ${constructor(n){super(),ee(this,n,be,ge,x,{kind:0,author:1,content:2,clientside:3,colour:4})}}function Y(s,n,e){const u=s.slice();return u[17]=n[e],u}function Z(s){let n,e;const u=[s[17]];let i={};for(let t=0;t<u.length;t+=1)i=ae(i,u[t]);return n=new ke({props:i}),{c(){fe(n.$$.fragment)},l(t){de(n.$$.fragment,t)},m(t,a){he(n,t,a),e=!0},p(t,a){const o=a&32?pe(u,[me(t[17])]):{};n.$set(o)},i(t){e||(J(n.$$.fragment,t),e=!0)},o(t){W(n.$$.fragment,t),e=!1},d(t){_e(n,t)}}}function we(s){let n,e,u=`Chat app made with <a href="https://github.com/tokio-rs/axum" style="color: #21bad1;">Axum</a>
    and
    <a href="https://kit.svelte.dev/" style="color: #ff531a;">SvelteKit</a>.`,i,t,a,o,l,c,j="Join chat",E,b,y,M,z,L,I,P,U,h,v=Q(s[5]),d=[];for(let r=0;r<v.length;r+=1)d[r]=Z(Y(s,v,r));const le=r=>W(d[r],1,1,()=>{d[r]=null});return{c(){n=S(),e=k("h1"),e.innerHTML=u,i=S(),t=k("div"),a=k("div"),o=k("input"),l=S(),c=k("button"),c.textContent=j,E=S(),b=k("div"),y=k("div");for(let r=0;r<d.length;r+=1)d[r].c();M=S(),z=k("span"),L=S(),I=k("input"),this.h()},l(r){re("svelte-14jt7jh",document.head).forEach(g),n=V(r),e=w(r,"H1",{["data-svelte-h"]:!0}),G(e)!=="svelte-uiuuyg"&&(e.innerHTML=u),i=V(r),t=w(r,"DIV",{id:!0,class:!0});var f=C(t);a=w(f,"DIV",{id:!0,class:!0});var D=C(a);o=w(D,"INPUT",{id:!0,class:!0}),l=V(D),c=w(D,"BUTTON",{id:!0,class:!0,["data-svelte-h"]:!0}),G(c)!=="svelte-js8t7x"&&(c.textContent=j),D.forEach(g),E=V(f),b=w(f,"DIV",{id:!0,class:!0});var A=C(b);y=w(A,"DIV",{id:!0,class:!0});var B=C(y);for(let O=0;O<d.length;O+=1)d[O].l(B);M=V(B),z=w(B,"SPAN",{}),C(z).forEach(g),B.forEach(g),L=V(A),I=w(A,"INPUT",{id:!0,class:!0}),A.forEach(g),f.forEach(g),this.h()},h(){document.title="Rust chat",_(o,"id","name-input"),_(o,"class","svelte-z8xppc"),_(c,"id","join-button"),_(c,"class","svelte-z8xppc"),_(a,"id","join-container"),_(a,"class","svelte-z8xppc"),_(y,"id","chat-area"),_(y,"class","svelte-z8xppc"),_(I,"id","message-input"),_(I,"class","svelte-z8xppc"),_(b,"id","chat-container"),_(b,"class","svelte-z8xppc"),_(t,"id","container"),_(t,"class","svelte-z8xppc")},m(r,p){T(r,n,p),T(r,e,p),T(r,i,p),T(r,t,p),m(t,a),m(a,o),H(o,s[3]),s[9](o),m(a,l),m(a,c),s[11](c),m(t,E),m(t,b),m(b,y);for(let f=0;f<d.length;f+=1)d[f]&&d[f].m(y,null);m(y,M),m(y,z),s[12](z),m(b,L),m(b,I),H(I,s[4]),P=!0,U||(h=[N(o,"input",s[8]),N(o,"keydown",s[10]),N(c,"click",s[7]),N(I,"input",s[13]),N(I,"keydown",s[14])],U=!0)},p(r,[p]){if(p&8&&o.value!==r[3]&&H(o,r[3]),p&32){v=Q(r[5]);let f;for(f=0;f<v.length;f+=1){const D=Y(r,v,f);d[f]?(d[f].p(D,p),J(d[f],1)):(d[f]=Z(D),d[f].c(),J(d[f],1),d[f].m(y,M))}for(ve(),f=v.length;f<d.length;f+=1)le(f);ue()}p&16&&I.value!==r[4]&&H(I,r[4])},i(r){if(!P){for(let p=0;p<v.length;p+=1)J(d[p]);P=!0}},o(r){d=d.filter(Boolean);for(let p=0;p<d.length;p+=1)W(d[p]);P=!1},d(r){r&&(g(n),g(e),g(i),g(t)),s[9](null),s[11](null),ce(d,r),s[12](null),U=!1,oe(h)}}}function Ee(){return Math.floor(Math.random()*16777215).toString(16).padStart(6,"0")}function ye(s,n,e){let u,i,t,a=!1,o,l="",c=[],j=new Map,E;async function b(){i.disabled||(e(1,i.disabled=!0,i),e(6,E=new WebSocket(`wss://${window.location.host}/websocket`)),E.addEventListener("open",h=>{E.send(o),e(0,u.disabled=!0,u)}),E.addEventListener("message",h=>{let v=JSON.parse(h.data);v.content=="Username already exists."&&e(1,i.disabled=!1,i),v.author===o?v.clientside=!0:v.clientside=!1,j.has(v.author)?v.colour=j.get(v.author):(v.colour=Ee(),j.set(v.author,v.colour)),e(5,c=[...c,v]),a=!0}),E.addEventListener("error",h=>{e(1,i.disabled=!1,i),console.log(h),alert("Connection closed.")}))}ie(()=>{a&&(t.scrollIntoView({behavior:"smooth"}),a=!1)});function y(){o=this.value,e(3,o)}function M(h){R[h?"unshift":"push"](()=>{u=h,e(0,u)})}const z=h=>{h.key=="Enter"&&o!==""&&!i.disabled&&b()};function L(h){R[h?"unshift":"push"](()=>{i=h,e(1,i)})}function I(h){R[h?"unshift":"push"](()=>{t=h,e(2,t)})}function P(){l=this.value,e(4,l)}return[u,i,t,o,l,c,E,b,y,M,z,L,I,P,h=>{h.key=="Enter"&&l!==""&&(E.send(l),e(4,l=""))}]}class Ce extends ${constructor(n){super(),ee(this,n,ye,we,x,{})}}export{Ce as component};
